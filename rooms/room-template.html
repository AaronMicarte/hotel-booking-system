<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Details - HellHotel</title>

    <!-- External CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/room-details.css">
</head>

<body>
    <!-- Header will be injected here -->
    <div id="header-container"></div>

    <div class="container mt-5 pt-3">
        <!-- Loading State -->
        <div id="roomLoading" class="text-center py-5">
            <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h4>Loading room details...</h4>
            <p class="text-muted">Please wait while we fetch the latest information</p>
        </div>

        <!-- Room Content -->
        <div id="roomContent" class="d-none">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
                    <li class="breadcrumb-item active" id="breadcrumbRoom">Room Details</li>
                </ol>
            </nav>

            <!-- Room Image -->
            <div class="mb-4">
                <img id="roomImage" src="" alt="Room Image" class="img-fluid rounded w-100"
                    style="height: 400px; object-fit: cover;">
            </div>

            <!-- Room Details -->
            <div class="row">
                <div class="col-lg-8">
                    <!-- Room Header -->
                    <div class="mb-4">
                        <h1 id="roomTitle" class="mb-2"></h1>
                        <p id="roomDescription" class="text-muted"></p>
                        <div class="bg-primary text-white d-inline-block px-3 py-2 rounded">
                            <span id="roomPrice" class="fw-bold fs-4"></span>
                            <small>/ <span id="roomPeriod"></span></small>
                        </div>
                    </div>

                    <!-- Room Info Grid -->
                    <div class="row mb-4">
                        <div class="col-sm-6 col-md-3 mb-3">
                            <div class="text-center p-3 border rounded">
                                <i class="fas fa-users text-primary fs-4 mb-2"></i>
                                <div class="small text-muted">Capacity</div>
                                <div id="roomCapacity" class="fw-bold"></div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3 mb-3">
                            <div class="text-center p-3 border rounded">
                                <i class="fas fa-expand text-primary fs-4 mb-2"></i>
                                <div class="small text-muted">Size</div>
                                <div id="roomSize" class="fw-bold"></div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3 mb-3">
                            <div class="text-center p-3 border rounded">
                                <i class="fas fa-sign-in-alt text-primary fs-4 mb-2"></i>
                                <div class="small text-muted">Check-in</div>
                                <div id="roomCheckIn" class="fw-bold"></div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3 mb-3">
                            <div class="text-center p-3 border rounded">
                                <i class="fas fa-sign-out-alt text-primary fs-4 mb-2"></i>
                                <div class="small text-muted">Check-out</div>
                                <div id="roomCheckOut" class="fw-bold"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Room Features -->
                    <div class="mb-4">
                        <h5 class="mb-3">Room Features</h5>
                        <div id="roomFeatures" class="row">
                            <!-- Features populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Booking Sidebar -->
                <div class="col-lg-4">
                    <div class="card sticky-top" style="top: 100px;">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-calendar-check me-2"></i>Book This Room</h5>
                            <div id="bookingRoomTitle" class="small opacity-75"></div>
                        </div>
                        <div class="card-body text-center">
                            <div class="pricing-display mb-4">
                                <div class="room-rate">
                                    <span id="displayRoomPrice" class="fs-2 fw-bold text-primary"></span>
                                    <small class="text-muted d-block">per 24-hour slot</small>
                                </div>
                                <div class="down-payment mt-2">
                                    <span class="text-muted">Down Payment (50%): </span>
                                    <span id="displayDownPayment" class="fw-bold text-success"></span>
                                </div>
                            </div>

                            <div class="booking-info mb-4">
                                <div class="info-item">
                                    <i class="fas fa-clock text-primary me-2"></i>
                                    <span>24-hour stay period</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-calendar text-primary me-2"></i>
                                    <span>Flexible check-in time</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-credit-card text-primary me-2"></i>
                                    <span>50% advance payment required</span>
                                </div>
                            </div>

                            <button class="btn btn-primary btn-lg w-100 mb-3" id="proceedToBookingBtn">
                                <i class="fas fa-calendar-plus me-2"></i>Proceed to Booking
                            </button>

                            <div class="alert alert-info small">
                                <i class="fas fa-info-circle me-1"></i>
                                Booking confirmation within 2-4 hours via email
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div id="roomError" class="text-center py-5 d-none">
            <i class="fas fa-bed text-muted mb-3" style="font-size: 3rem;"></i>
            <h4 class="text-dark">Room Not Available</h4>
            <p class="text-muted mb-4">The requested room type is currently not available or doesn't exist.</p>
            <div class="d-flex gap-3 justify-content-center">
                <button class="btn btn-primary" onclick="window.history.back()">
                    <i class="fas fa-arrow-left me-2"></i>Go Back
                </button>
                <a href="../index.html" class="btn btn-outline-primary">
                    <i class="fas fa-search me-2"></i>Browse All Rooms
                </a>
            </div>
        </div>
    </div>

    <!-- Footer will be injected here -->
    <!-- <div id="footer-container"></div> -->

    <!-- Scripts - FIXED MODULE LOADING -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Load core utilities first -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/components.js"></script>

    <!-- Fallback room data in case JS files don't load -->
    <script>
        // Enhanced fallback room data matching database structure
        window.RoomData = window.RoomData || {
            rooms: {
                'regular': {
                    id: 'REGULAR',
                    title: 'Regular Room',
                    description: 'Comfortable standard room with essential amenities.',
                    price: 999,
                    capacity: '2 Adults',
                    size: '20 m²',
                    checkIn: '12:00 PM',
                    checkOut: '12:00 PM',
                    period: '24 hours',
                    image: '../assets/images/regular/regular-1.jpg',
                    features: [
                        'Double bed', 'Air conditioning', 'Flat-screen TV',
                        'Free Wi-Fi', 'Private bathroom', 'Daily housekeeping'
                    ]
                },
                'deluxe': {
                    id: 'DELUXE',
                    title: 'Deluxe Room',
                    description: 'Spacious deluxe room with upgraded amenities and city views.',
                    price: 1999,
                    capacity: '2 Adults, 1 Child',
                    size: '24 m²',
                    checkIn: '12:00 PM',
                    checkOut: '12:00 PM',
                    period: '24 hours',
                    image: '../assets/images/deluxe/deluxe-1.jpg',
                    features: [
                        'Queen-sized bed', 'Premium air conditioning', 'Large flat-screen TV',
                        'High-speed Wi-Fi', 'Luxury bathroom with tub', 'Mini bar',
                        'Coffee maker', 'Daily housekeeping'
                    ]
                },
                'executive': {
                    id: 'EXECUTIVE',
                    title: 'Executive Suite',
                    description: 'Luxurious suite with separate living area and premium amenities.',
                    price: 2999,
                    capacity: '2 Adults, 2 Children',
                    size: '35 m²',
                    checkIn: '12:00 PM',
                    checkOut: '12:00 PM',
                    period: '24 hours',
                    image: '../assets/images/executive/executive-1.jpg',
                    features: [
                        'King-sized bed', 'Separate living area', 'Climate control',
                        '43-inch smart TV', 'High-speed Wi-Fi', 'Luxury bathroom with jacuzzi',
                        'Mini bar', 'Coffee maker', 'Work desk', 'Daily housekeeping',
                        'Bathrobes and slippers', 'Welcome fruits'
                    ]
                }
            },
            getRoomByType: function (type) {
                const normalizedType = type.toLowerCase();
                return this.rooms[normalizedType] || this.rooms['regular'];
            },
            getAllRooms: function () {
                return Object.values(this.rooms);
            },
            getRoomData: function (type) {
                return this.getRoomByType(type);
            },
            getFormattedPrice: function (type) {
                const room = this.getRoomByType(type);
                return room ? `₱${room.price.toLocaleString()}` : '₱0';
            },
            getDownPayment: function (type) {
                const room = this.getRoomByType(type);
                return room ? room.price * 0.5 : 0;
            }
        };

        // Fallback RoomPageManager if the external file fails to load
        window.RoomPageManager = window.RoomPageManager || {
            initialize: function (roomType) {
                console.log('Fallback RoomPageManager initializing with room type:', roomType);

                // Get room data (with fallback to regular if type not found)
                const room = window.RoomData.getRoomByType(roomType);

                if (!room) {
                    console.error('Room not found even in fallback data');
                    document.getElementById('roomLoading').classList.add('d-none');
                    document.getElementById('roomError').classList.remove('d-none');
                    return;
                }

                // Set room details
                document.getElementById('roomTitle').textContent = room.title;
                document.getElementById('roomDescription').textContent = room.description;
                document.getElementById('roomPrice').textContent = '₱' + room.price.toLocaleString();
                document.getElementById('roomPeriod').textContent = room.period;
                document.getElementById('roomCapacity').textContent = room.capacity;
                document.getElementById('roomSize').textContent = room.size;
                document.getElementById('roomCheckIn').textContent = room.checkIn;
                document.getElementById('roomCheckOut').textContent = room.checkOut;

                // Set image with fallback
                const roomImage = document.getElementById('roomImage');
                roomImage.src = room.image || '../assets/images/rooms/room-placeholder.jpg';
                roomImage.alt = room.title;

                // Set breadcrumb
                document.getElementById('breadcrumbRoom').textContent = room.title;

                // Set booking sidebar details
                document.getElementById('bookingRoomTitle').textContent = room.title;
                document.getElementById('displayRoomPrice').textContent = '₱' + room.price.toLocaleString();
                document.getElementById('displayDownPayment').textContent = '₱' + (room.price * 0.5).toLocaleString();

                // Populate features
                const featuresContainer = document.getElementById('roomFeatures');
                if (featuresContainer && room.features) {
                    featuresContainer.innerHTML = '';

                    room.features.forEach(feature => {
                        const featureCol = document.createElement('div');
                        featureCol.className = 'col-md-6 mb-2';

                        const featureItem = document.createElement('div');
                        featureItem.className = 'feature-item';
                        featureItem.innerHTML = `<i class="fas fa-check text-success me-2"></i> ${feature}`;

                        featureCol.appendChild(featureItem);
                        featuresContainer.appendChild(featureCol);
                    });
                }

                // Show content
                document.getElementById('roomLoading').classList.add('d-none');
                document.getElementById('roomContent').classList.remove('d-none');
            }
        };
    </script>

    <!-- Try to load the external files, but we have fallbacks above -->
    <script src="../assets/js/room-data.js"></script>
    <script src="../assets/js/room-page.js"></script>
    <script src="../assets/js/booking.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            console.log('DOM loaded, initializing room template...');

            // Load header and footer first
            if (window.Components) {
                window.Components.loadHeader('header-container', '../');
                // window.Components.loadFooter('footer-container', '../');
            }

            // Get room type from URL with debugging
            const urlParams = new URLSearchParams(window.location.search);
            const roomType = urlParams.get('type') || 'regular';
            console.log('Room type from URL:', roomType);

            // List available room types for debugging
            if (window.RoomData && window.RoomData.rooms) {
                console.log('Available room types:', Object.keys(window.RoomData.rooms));
            }

            // Initialize with the requested room type
            console.log('RoomData available:', !!window.RoomData);
            console.log('RoomPageManager available:', !!window.RoomPageManager);

            if (window.RoomData && window.RoomPageManager) {
                console.log('Modules loaded, initializing room page...');
                window.RoomPageManager.initialize(roomType);
            } else {
                console.error('Required modules not loaded, showing error state');
                document.getElementById('roomLoading').classList.add('d-none');
                document.getElementById('roomError').classList.remove('d-none');
            }

            // Setup booking button
            const proceedBtn = document.getElementById('proceedToBookingBtn');
            if (proceedBtn) {
                proceedBtn.addEventListener('click', function () {
                    console.log('Proceed to booking clicked for room:', roomType);
                    sessionStorage.setItem('selectedRoomType', roomType);

                    if (window.HotelUtils) {
                        window.HotelUtils.showToast('Redirecting', 'Opening booking form...', 'info');
                    }

                    setTimeout(() => {
                        window.location.href = '../pages/booking-form.html';
                    }, 500);
                });
            }
        });
    </script>
</body>

</html>